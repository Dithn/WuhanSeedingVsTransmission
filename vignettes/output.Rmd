---
title: "Wuhan: Seeding vs transmission"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{Wuhan: Seeding vs transmission}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
bibliography: resources/library.bib
---







## Abstract 

## Introduction

## Methods

### Branching process model

We modelled the outbreak using a stochastic branching process. We assumed that cases from the initial seeding event were uniformly distributed over the duration of the seeding event. Each case then resulted in a subsequent generation of cases with the number that each case generated being drawn from a negative binomial distribution - to account for overdisperion -  with a dispersion of 0.16 (assuming SARs like dispersion)[@Lipsitch:2003]. The mean number of cases generated by each case (the reproduction number) was sampled from a uniform distribution once per model simulation with a lower bound of 0 and an upper bound determined by the scenario being evaluated. Generations were then sampled iteratively until the maximum simulation time was reached. The serial interval between each generation was assumed to be normal with a mean varied during the scenario analysis and a standard deviation of 3.8 (assuming a SARS like distribution)[@Lipsitch:2003]. After the simulation of the branching process reporting delay was added to each case. The reporting delay was sampled from either a normal, a poisson, or a negative binomial distribution. This was determined by fitting these distributions to the compiled linelist of cases in China (*reference needed*) and selecting the best fit using the Chi-squared statistic. If no good fit was determined - using an arbitary thresold of 0.05 - then the reporting delay was instead sampled from the reported delays in the linelist.
   
### Scenario analysis

We simulated the branching process model 10,000 times for all combinations of the following parameters: seeding event size (20, 40, 60, 80, 200), seeding event duration (7 days, 14 days, 21 days, and 28 days), the mean of the serial interval (4 days, 8.4 days[@Lipsitch:2003], 12)), and the upper bound of the reproduction number (1, 2, 3, 4). Parameter values used in the scenario analysis were either assumptions based on the current knowledge of the Wuhan outbreak or based on those used previously for SARs[@Lipsitch:2003]. We ran the model from the beginning of the outbreak for each scenario until the 25th of January 2020. The start date was determined by combining the duration of the seeding event with the date the fish market in Wuhan - the source of the outbreak - closed (31st of December 2019). Outbreak simulation was stopped if a sample exceeded 5000 cases by the end of simulation period.



### Conditioning on available case numbers

We evaluated each scenario sample based on the cases observed on the 3rd of January (41 observed cases with an assumed upper bound of 400 cases), the 18th of Janurary (200 cases with an assumed upper bound of 2000 cases), and the 25th of January (1975 cases with an assumed upper bound of 5000 cases). Samples were rejected if their simulated cumulative cases were not consistent with these data. Uncertainty in the observed number of cases was assumed to be 10 times the number of observed cases for the 3rd and 18th of January and the number of observed plus the number of potential cases reported on the 25th of January. 




### Analysis

We compared the percentage of samples that were accepted stratified by the seeding event size and seeding event duration for every combination of upper reproduction number bounds and mean serial intervals. We then used heatmaps to identify which scenarios were more likely to represent the underlying outbreak. We then reported the median, maximum, and minimum reproduction numbers of samples accepted after conditioning on the observed data, stratified by the seeding event size, seeding event duration and the assumed mean serial interval.




### Implementatation

All analysis was carried out using R version 3.6.2[@R]. The branching process model was implemented using the `bpmodels` package[@bpmodels]. The analysis is available as an open-source R package (*need reference - zenodo doi*). A dockerfile has been made available with the code to ensure reproducibility[@Boettiger:2015dw]. All analysis was run on a 16 core 4Ghz machine.

## Results

### Percentage of accepted outbreak simulation

![plot of chunk plot-probs](figures/plot-probs-1.png)


### Estimated reproduction number


|Seeding event size vs. Seeding event duration |7               |14            |28              |
|:---------------------------------------------|:---------------|:-------------|:---------------|
|20                                            |3.6 (3.3 - 3.8) |3.5 (2 - 4)   |3.1 (1.6 - 4)   |
|40                                            |3.5 (2.7 - 4)   |3.3 (2.1 - 4) |2.6 (1.4 - 4)   |
|60                                            |3.4 (2.3 - 4)   |3.1 (1.8 - 4) |2.3 (1.6 - 4)   |
|80                                            |3.3 (2.1 - 4)   |2.8 (1.9 - 4) |2.1 (1.5 - 3.4) |
|100                                           |3.1 (2.1 - 4)   |2.6 (1.7 - 4) |2 (1.5 - 3.1)   |
|200                                           |2.4 (1.6 - 3.8) |2 (1.3 - 2.9) |1.7 (1.6 - 2.1) |


|Seeding event size vs. Seeding event duration |7             |14            |28              |
|:---------------------------------------------|:-------------|:-------------|:---------------|
|20                                            |-             |-             |3.6 (2.4 - 4)   |
|40                                            |-             |3.9 (3.8 - 4) |3.6 (2.3 - 4)   |
|60                                            |-             |3.8 (3.3 - 4) |3.4 (2.2 - 4)   |
|80                                            |-             |3.8 (3 - 4)   |3.3 (1.9 - 4)   |
|100                                           |3.9 (3.8 - 4) |3.7 (2.7 - 4) |3.1 (1.7 - 4)   |
|200                                           |3.7 (2.5 - 4) |3.3 (2.1 - 4) |2.4 (1.7 - 3.3) |


## Discussion


